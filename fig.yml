web:
  build: .
  ports:
  - "5000:80"
  command: /bin/bash -c 'cd /code; python main.py'
  links:
   - redis
   - couch
  environment: !include env.yml
worker:
  build: .
  command: /bin/bash -c 'cd /code; celery worker --app=main.celery --loglevel=info --concurrency=10 --hostname=worker%I.%h --maxtasksperchild=100 --autoscale=10,3'
  links:
   - redis
   - couch
  environment: !include env.yml
flower:
  build: .
  command: /bin/bash -c 'cd /code; celery flower --app=main.celery'
  ports:
  - "5555:5555"
  links:
   - redis
   - couch
redis:
  image: crosbymichael/redis
couch:
  image: klaemo/couchdb
haproxy:
  image: tutum/haproxy-http
  ports:
  - "80:80"
  links:
   - web